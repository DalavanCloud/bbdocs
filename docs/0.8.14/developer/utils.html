<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Utilities &mdash; Buildbot 0.8.14 documentation</title>
    
    <link rel="stylesheet" href="../_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.8.14',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/buildbot.ico"/>
    <link rel="top" title="Buildbot 0.8.14 documentation" href="../index.html" />
    <link rel="up" title="Buildbot Development" href="index.html" />
    <link rel="next" title="Database" href="database.html" />
    <link rel="prev" title="Configuration" href="config.html" /> 
  <!-- GA-TRACKING-START -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try{
var pageTracker = _gat._getTracker("UA-12313843-4");
pageTracker._setDomainName("none");
pageTracker._setAllowLinker(true);
pageTracker._trackPageview();
} catch(err) {}
</script>
<!-- GA-TRACKING-END -->
</head>
  <body role="document">
    <div class="header-wrapper" role="banner">
      <div class="header">
          <p class="logo"><a href="../index.html">
            <img class="logo" src="../_static/header-text-transparent.png" alt="Logo"/>
          </a></p>
        <div class="headertitle"><a
          href="../index.html">Buildbot 0.8.14 documentation</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="config.html" title="Configuration"
             accesskey="P">previous</a> |
          <a href="database.html" title="Database"
             accesskey="N">next</a> |
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-buildbot.util">
<span id="utilities"></span><h1>Utilities<a class="headerlink" href="#module-buildbot.util" title="Permalink to this headline">¶</a></h1>
<p>Several small utilities are available at the top-level <a class="reference internal" href="#module-buildbot.util" title="buildbot.util"><code class="xref py py-mod docutils literal"><span class="pre">buildbot.util</span></code></a>
package.</p>
<dl class="function">
<dt id="buildbot.util.naturalSort">
<code class="descclassname">buildbot.util.</code><code class="descname">naturalSort</code><span class="sig-paren">(</span><em>list</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.naturalSort" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>list</strong> -- list of strings</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">sorted strings</td>
</tr>
</tbody>
</table>
<p>This function sorts strings &quot;naturally&quot;, with embedded numbers sorted
numerically.  This ordering is good for objects which might have a numeric
suffix, e.g., <code class="docutils literal"><span class="pre">winslave1</span></code>, <code class="docutils literal"><span class="pre">winslave2</span></code></p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.formatInterval">
<code class="descclassname">buildbot.util.</code><code class="descname">formatInterval</code><span class="sig-paren">(</span><em>interval</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.formatInterval" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>interval</strong> -- duration in seconds</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">human-readable (English) equivalent</td>
</tr>
</tbody>
</table>
<p>This function will return a human-readable string describing a length of
time, given a number of seconds.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.util.ComparableMixin">
<em class="property">class </em><code class="descclassname">buildbot.util.</code><code class="descname">ComparableMixin</code><a class="headerlink" href="#buildbot.util.ComparableMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>This mixin class adds comparability to a subclass.  Use it like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Widget</span><span class="p">(</span><span class="n">FactoryProduct</span><span class="p">,</span> <span class="n">ComparableMixin</span><span class="p">):</span>
    <span class="n">compare_attrs</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;radius&#39;</span><span class="p">,</span> <span class="s1">&#39;thickness&#39;</span> <span class="p">]</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>Any attributes not in <code class="docutils literal"><span class="pre">compare_attrs</span></code> will not be considered when
comparing objects.  This is particularly useful in implementing buildbot's
reconfig logic, where a simple comparison between the new and existing objects
can determine whether the new object should replace the existing object.</p>
<p>A point to note is that the compare_attrs list is cumulative; that is,
when a subclass also has a compare_attrs and the parent class has a
compare_attrs, the subclass' compare_attrs also includes the parent
class' compare_attrs.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.safeTranslate">
<code class="descclassname">buildbot.util.</code><code class="descname">safeTranslate</code><span class="sig-paren">(</span><em>str</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.safeTranslate" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>str</strong> -- input string</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">safe version of the input</td>
</tr>
</tbody>
</table>
<p>This function will filter out some inappropriate characters for filenames;
it is suitable for adapting strings from the configuration for use as
filenames.  It is not suitable for use with strings from untrusted sources.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.epoch2datetime">
<code class="descclassname">buildbot.util.</code><code class="descname">epoch2datetime</code><span class="sig-paren">(</span><em>epoch</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.epoch2datetime" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>epoch</strong> -- an epoch time (integer)</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">equivalent datetime object</td>
</tr>
</tbody>
</table>
<p>Convert a UNIX epoch timestamp to a Python datetime object, in the UTC
timezone.  Note that timestamps specify UTC time (modulo leap seconds and a
few other minor details).</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.datetime2epoch">
<code class="descclassname">buildbot.util.</code><code class="descname">datetime2epoch</code><span class="sig-paren">(</span><em>datetime</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.datetime2epoch" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>datetime</strong> -- a datetime object</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">equivalent epoch time (integer)</td>
</tr>
</tbody>
</table>
<p>Convert an arbitrary Python datetime object into a UNIX epoch timestamp.</p>
</dd></dl>

<dl class="data">
<dt id="buildbot.util.UTC">
<code class="descclassname">buildbot.util.</code><code class="descname">UTC</code><a class="headerlink" href="#buildbot.util.UTC" title="Permalink to this definition">¶</a></dt>
<dd><p>A <code class="docutils literal"><span class="pre">datetime.tzinfo</span></code> subclass representing UTC time.  A similar class has
finally been added to Python in version 3.2, but the implementation is simple
enough to include here.  This is mostly used in tests to create timezone-aware
datetime objects in UTC:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1978</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">UTC</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.diffSets">
<code class="descclassname">buildbot.util.</code><code class="descname">diffSets</code><span class="sig-paren">(</span><em>old</em>, <em>new</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.diffSets" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>old</strong> (<em>set or iterable</em>) -- old set</li>
<li><strong>new</strong> (<em>set or iterable</em>) -- new set</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a tuple, (removed, added)</p>
</td>
</tr>
</tbody>
</table>
<p>This function compares two sets of objects, returning elements that were
added and elements that were removed.  This is largely a convenience
function for reconfiguring services.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.makeList">
<code class="descclassname">buildbot.util.</code><code class="descname">makeList</code><span class="sig-paren">(</span><em>input</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.makeList" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>input</strong> -- a thing</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">a list of zero or more things</td>
</tr>
</tbody>
</table>
<p>This function is intended to support the many places in Buildbot where the
user can specify either a string or a list of strings, but the
implementation wishes to always consider lists.  It converts any string to
a single-element list, <code class="docutils literal"><span class="pre">None</span></code> to an empty list, and any iterable to a
list.  Input lists are copied, avoiding aliasing issues.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.now">
<code class="descclassname">buildbot.util.</code><code class="descname">now</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.now" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">epoch time (integer)</td>
</tr>
</tbody>
</table>
<p>Return the current time, using either <code class="docutils literal"><span class="pre">reactor.seconds</span></code> or
<code class="docutils literal"><span class="pre">time.time()</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.flatten">
<code class="descclassname">buildbot.util.</code><code class="descname">flatten</code><span class="sig-paren">(</span><em>list</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.flatten" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>list</strong> -- potentially nested list</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">flat list</td>
</tr>
</tbody>
</table>
<p>Flatten nested lists into a list containing no other lists.  For example:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>&gt;&gt;&gt; flatten([ [  1, 2 ], 3, [ [ 4 ] ] ])
[ 1, 2, 3, 4 ]
</pre></div>
</div>
<p>Note that this looks strictly for lists -- tuples, for example, are not
flattened.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.none_or_str">
<code class="descclassname">buildbot.util.</code><code class="descname">none_or_str</code><span class="sig-paren">(</span><em>obj</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.none_or_str" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>obj</strong> -- input value</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">string or <code class="docutils literal"><span class="pre">None</span></code></td>
</tr>
</tbody>
</table>
<p>If <code class="docutils literal"><span class="pre">obj</span></code> is not None, return its string representation.</p>
</dd></dl>

<dl class="data">
<dt id="buildbot.util.NotABranch">
<code class="descclassname">buildbot.util.</code><code class="descname">NotABranch</code><a class="headerlink" href="#buildbot.util.NotABranch" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a sentinel value used to indicate that no branch is specified.  It
is necessary since schedulers and change sources consider <code class="docutils literal"><span class="pre">None</span></code> a valid
name for a branch.  This is generally used as a default value in a method
signature, and then tested against with <code class="docutils literal"><span class="pre">is</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">branch</span> <span class="ow">is</span> <span class="n">NotABranch</span><span class="p">:</span>
    <span class="k">pass</span> <span class="c1"># ...</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.in_reactor">
<code class="descclassname">buildbot.util.</code><code class="descname">in_reactor</code><span class="sig-paren">(</span><em>fn</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.in_reactor" title="Permalink to this definition">¶</a></dt>
<dd><p>This decorator will cause the wrapped function to be run in the Twisted
reactor, with the reactor stopped when the function completes.  It returns
the result of the wrapped function.  If the wrapped function fails, its
traceback will be printed, the reactor halted, and <code class="docutils literal"><span class="pre">None</span></code> returned.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.asyncSleep">
<code class="descclassname">buildbot.util.</code><code class="descname">asyncSleep</code><span class="sig-paren">(</span><em>secs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.asyncSleep" title="Permalink to this definition">¶</a></dt>
<dd><p>Yield a deferred that will fire with no result after <code class="docutils literal"><span class="pre">secs</span></code> seconds.
This is the asynchronous equivalent to <code class="docutils literal"><span class="pre">time.sleep</span></code>, and can be useful in tests.</p>
</dd></dl>

<div class="section" id="module-buildbot.util.lru">
<span id="buildbot-util-lru"></span><h2>buildbot.util.lru<a class="headerlink" href="#module-buildbot.util.lru" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt>
<code class="descname">LRUCache(miss_fn, max_size=50):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>miss_fn</strong> -- function to call, with key as parameter, for cache misses.
The function should return the value associated with the key argument,
or None if there is no value associated with the key.</li>
<li><strong>max_size</strong> -- maximum number of objects in the cache.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This is a simple least-recently-used cache.  When the cache grows beyond
the maximum size, the least-recently used items will be automatically
removed from the cache.</p>
<p>This cache is designed to control memory usage by minimizing duplication of
objects, while avoiding unnecessary re-fetching of the same rows from the
database.</p>
<p>All values are also stored in a weak valued dictionary, even after they
have expired from the cache.  This allows values that are used elsewhere in
Buildbot to &quot;stick&quot; in the cache in case they are needed by another
component.  Weak references cannot be used for some types, so these types
are not compatible with this class.  Note that dictionaries can be weakly
referenced if they are an instance of a subclass of <code class="docutils literal"><span class="pre">dict</span></code>.</p>
<p>If the result of the <code class="docutils literal"><span class="pre">miss_fn</span></code> is <code class="docutils literal"><span class="pre">None</span></code>, then the value is not cached;
this is intended to avoid caching negative results.</p>
<p>This is based on <a class="reference external" href="http://code.activestate.com/recipes/498245-lru-and-lfu-cache-decorators/">Raymond Hettinger's implementation</a>,
licensed under the PSF license, which is GPL-compatiblie.</p>
<dl class="attribute">
<dt id="buildbot.util.lru.hits">
<code class="descclassname">buildbot.util.lru.</code><code class="descname">hits</code><a class="headerlink" href="#buildbot.util.lru.hits" title="Permalink to this definition">¶</a></dt>
<dd><p>cache hits so far</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.lru.refhits">
<code class="descclassname">buildbot.util.lru.</code><code class="descname">refhits</code><a class="headerlink" href="#buildbot.util.lru.refhits" title="Permalink to this definition">¶</a></dt>
<dd><p>cache misses found in the weak ref dictionary, so far</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.lru.misses">
<code class="descclassname">buildbot.util.lru.</code><code class="descname">misses</code><a class="headerlink" href="#buildbot.util.lru.misses" title="Permalink to this definition">¶</a></dt>
<dd><p>cache misses leading to re-fetches, so far</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.lru.max_size">
<code class="descclassname">buildbot.util.lru.</code><code class="descname">max_size</code><a class="headerlink" href="#buildbot.util.lru.max_size" title="Permalink to this definition">¶</a></dt>
<dd><p>maximum allowed size of the cache</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.lru.get">
<code class="descclassname">buildbot.util.lru.</code><code class="descname">get</code><span class="sig-paren">(</span><em>key</em>, <em>**miss_fn_kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.lru.get" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> -- cache key</li>
<li><strong>miss_fn_kwargs</strong> -- keyword arguments to the <code class="docutils literal"><span class="pre">miss_fn</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">value via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Fetch a value from the cache by key, invoking <code class="docutils literal"><span class="pre">miss_fn(key,</span>
<span class="pre">**miss_fn_kwargs)</span></code> if the key is not in the cache.</p>
<p>Any additional keyword arguments are passed to the <code class="docutils literal"><span class="pre">miss_fn</span></code> as
keyword arguments; these can supply additional information relating to
the key.  It is up to the caller to ensure that this information is
functionally identical for each key value: if the key is already in the
cache, the <code class="docutils literal"><span class="pre">miss_fn</span></code> will not be invoked, even if the keyword
arguments differ.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.lru.put">
<code class="descclassname">buildbot.util.lru.</code><code class="descname">put</code><span class="sig-paren">(</span><em>key</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.lru.put" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>key</strong> -- key at which to place the value</li>
<li><strong>value</strong> -- value to place there</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Add the given key and value into the cache.  The purpose of this
method is to insert a new value into the cache <em>without</em> invoking
the miss_fn (e.g., to avoid unnecessary overhead).</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.lru.inv">
<code class="descclassname">buildbot.util.lru.</code><code class="descname">inv</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.lru.inv" title="Permalink to this definition">¶</a></dt>
<dd><p>Check invariants on the cache.  This is intended for debugging
purposes.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt>
<code class="descname">AsyncLRUCache(miss_fn, max_size=50):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>miss_fn</strong> -- This is the same as the miss_fn for class LRUCache, with
the difference that this function <em>must</em> return a Deferred.</li>
<li><strong>max_size</strong> -- maximum number of objects in the cache.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This class has the same functional interface as LRUCache, but asynchronous
locking is used to ensure that in the common case of multiple concurrent
requests for the same key, only one fetch is performed.</p>
</dd></dl>

</div>
<div class="section" id="module-buildbot.util.bbcollections">
<span id="buildbot-util-bbcollections"></span><h2>buildbot.util.bbcollections<a class="headerlink" href="#module-buildbot.util.bbcollections" title="Permalink to this headline">¶</a></h2>
<p>This package provides a few useful collection objects.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This module used to be named <code class="docutils literal"><span class="pre">collections</span></code>, but without absolute
imports (<span class="target" id="index-0"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0328"><strong>PEP 328</strong></a>), this precluded using the standard library's
<code class="docutils literal"><span class="pre">collections</span></code> module.</p>
</div>
<dl class="class">
<dt id="buildbot.util.bbcollections.defaultdict">
<em class="property">class </em><code class="descclassname">buildbot.util.bbcollections.</code><code class="descname">defaultdict</code><a class="headerlink" href="#buildbot.util.bbcollections.defaultdict" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a clone of the Python <code class="xref py py-class docutils literal"><span class="pre">collections.defaultdict</span></code> for use in
Python-2.4.  In later versions, this is simply a reference to the built-in
<a class="reference internal" href="#buildbot.util.bbcollections.defaultdict" title="buildbot.util.bbcollections.defaultdict"><code class="xref py py-class docutils literal"><span class="pre">defaultdict</span></code></a>, so buildbot code can simply use
<code class="xref py py-class docutils literal"><span class="pre">buildbot.util.collections.defaultdict</span></code> everywhere.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.util.bbcollections.KeyedSets">
<em class="property">class </em><code class="descclassname">buildbot.util.bbcollections.</code><code class="descname">KeyedSets</code><a class="headerlink" href="#buildbot.util.bbcollections.KeyedSets" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a collection of named sets.  In principal, it contains an empty set
for every name, and you can add things to sets, discard things from sets,
and so on.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span> <span class="o">=</span> <span class="n">KeyedSets</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="p">[</span><span class="s1">&#39;tim&#39;</span><span class="p">]</span>                   <span class="c1"># get a named set</span>
<span class="go">set([])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;tim&#39;</span><span class="p">,</span> <span class="s1">&#39;friendly&#39;</span><span class="p">)</span>   <span class="c1"># add an element to a set</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;tim&#39;</span><span class="p">,</span> <span class="s1">&#39;dexterous&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="p">[</span><span class="s1">&#39;tim&#39;</span><span class="p">]</span>
<span class="go">set([&#39;friendly&#39;, &#39;dexterous&#39;])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;tim&#39;</span> <span class="ow">in</span> <span class="n">ks</span>                 <span class="c1"># membership testing</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;ron&#39;</span> <span class="ow">in</span> <span class="n">ks</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="s1">&#39;tim&#39;</span><span class="p">,</span> <span class="s1">&#39;friendly&#39;</span><span class="p">)</span><span class="c1"># discard set element</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tim&#39;</span><span class="p">)</span>               <span class="c1"># return set and reset to empty</span>
<span class="go">set([&#39;dexterous&#39;])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="p">[</span><span class="s1">&#39;tim&#39;</span><span class="p">]</span>
<span class="go">set([])</span>
</pre></div>
</div>
<p>This class is careful to conserve memory space - empty sets do not occupy
any space.</p>
</dd></dl>

</div>
<div class="section" id="module-buildbot.util.eventual">
<span id="buildbot-util-eventual"></span><h2>buildbot.util.eventual<a class="headerlink" href="#module-buildbot.util.eventual" title="Permalink to this headline">¶</a></h2>
<p>This function provides a simple way to say &quot;please do this later&quot;.  For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.util.eventual</span> <span class="k">import</span> <span class="n">eventually</span>
<span class="k">def</span> <span class="nf">do_what_I_say</span><span class="p">(</span><span class="n">what</span><span class="p">,</span> <span class="n">where</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="k">return</span> <span class="n">d</span>
<span class="n">eventually</span><span class="p">(</span><span class="n">do_what_I_say</span><span class="p">,</span> <span class="s2">&quot;clean up&quot;</span><span class="p">,</span> <span class="s2">&quot;your bedroom&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The package defines &quot;later&quot; as &quot;next time the reactor has control&quot;, so this is
a good way to avoid long loops that block other activity in the reactor.</p>
<dl class="function">
<dt id="buildbot.util.eventual.eventually">
<code class="descclassname">buildbot.util.eventual.</code><code class="descname">eventually</code><span class="sig-paren">(</span><em>cb</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.eventual.eventually" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>cb</strong> -- callable to invoke later</li>
<li><strong>args</strong> -- args to pass to <code class="docutils literal"><span class="pre">cb</span></code></li>
<li><strong>kwargs</strong> -- kwargs to pass to <code class="docutils literal"><span class="pre">cb</span></code></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Invoke the callable <code class="docutils literal"><span class="pre">cb</span></code> in a later reactor turn.</p>
<p>Callables given to <a class="reference internal" href="#buildbot.util.eventual.eventually" title="buildbot.util.eventual.eventually"><code class="xref py py-func docutils literal"><span class="pre">eventually</span></code></a> are guaranteed to be called in the
same order as the calls to <a class="reference internal" href="#buildbot.util.eventual.eventually" title="buildbot.util.eventual.eventually"><code class="xref py py-func docutils literal"><span class="pre">eventually</span></code></a> -- writing <code class="docutils literal"><span class="pre">eventually(a);</span>
<span class="pre">eventually(b)</span></code> guarantees that <code class="docutils literal"><span class="pre">a</span></code> will be called before <code class="docutils literal"><span class="pre">b</span></code>.</p>
<p>Any exceptions that occur in the callable will be logged with
<code class="docutils literal"><span class="pre">log.err()</span></code>.  If you really want to ignore them, provide a callable that
catches those exceptions.</p>
<p>This function returns None. If you care to know when the callable was
run, be sure to provide a callable that notifies somebody.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.eventual.fireEventually">
<code class="descclassname">buildbot.util.eventual.</code><code class="descname">fireEventually</code><span class="sig-paren">(</span><em>value=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.eventual.fireEventually" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> -- value with which the Deferred should fire</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>This function returns a Deferred which will fire in a later reactor turn,
after the current call stack has been completed, and after all other
Deferreds previously scheduled with <a class="reference internal" href="#buildbot.util.eventual.eventually" title="buildbot.util.eventual.eventually"><code class="xref py py-func docutils literal"><span class="pre">eventually</span></code></a>.  The returned
Deferred will never fail.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.eventual.flushEventualQueue">
<code class="descclassname">buildbot.util.eventual.</code><code class="descname">flushEventualQueue</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.eventual.flushEventualQueue" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>This returns a Deferred which fires when the eventual-send queue is finally
empty. This is useful for tests and other circumstances where it is useful
to know that &quot;later&quot; has arrived.</p>
</dd></dl>

</div>
<div class="section" id="module-buildbot.util.debounce">
<span id="buildbot-util-debounce"></span><h2>buildbot.util.debounce<a class="headerlink" href="#module-buildbot.util.debounce" title="Permalink to this headline">¶</a></h2>
<p>Often, a method must be called exactly once at a time, but many events may trigger a call to the method.
A simple example is the step method <a class="reference internal" href="cls-buildsteps.html#buildbot.process.buildstep.BuildStep.updateSummary" title="buildbot.process.buildstep.BuildStep.updateSummary"><code class="xref py py-meth docutils literal"><span class="pre">updateSummary</span></code></a>.</p>
<p>The <code class="docutils literal"><span class="pre">debounce.method(wait)</span></code> decorator is the tool for the job.</p>
<dl class="function">
<dt id="buildbot.util.debounce.method">
<code class="descclassname">buildbot.util.debounce.</code><code class="descname">method</code><span class="sig-paren">(</span><em>wait</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.debounce.method" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>wait</strong> -- time to wait before invoking, in seconds</td>
</tr>
</tbody>
</table>
<p>Returns a decorator that debounces the underlying method.
The underlying method must take no arguments (except <code class="docutils literal"><span class="pre">self</span></code>).</p>
<p>For each call to the decorated method, the underlying method will be invocation at least once within <em>wait</em> seconds (plus the time the method takes to execute).
Calls are &quot;debounced&quot; during that time, meaning that multiple calls to the decorated method may result in a single invocation.</p>
<p>The decorated method is an instance of <a class="reference internal" href="#buildbot.util.debounce.Debouncer" title="buildbot.util.debounce.Debouncer"><code class="xref py py-class docutils literal"><span class="pre">Debouncer</span></code></a>, allowing it to be started and stopped.
This is useful when the method is a part of a Buidbot service: call <code class="docutils literal"><span class="pre">method.start()</span></code> from <code class="docutils literal"><span class="pre">startService</span></code> and <code class="docutils literal"><span class="pre">method.stop()</span></code> from <code class="docutils literal"><span class="pre">stopService</span></code>, handling its Deferred appropriately.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.util.debounce.Debouncer">
<em class="property">class </em><code class="descclassname">buildbot.util.debounce.</code><code class="descname">Debouncer</code><a class="headerlink" href="#buildbot.util.debounce.Debouncer" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="buildbot.util.debounce.Debouncer.stop">
<code class="descname">stop</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.debounce.Debouncer.stop" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Stop the debouncer.
While the debouncer is stopped, calls to the decorated method will be ignored.
When the Deferred that <code class="docutils literal"><span class="pre">stop</span></code> returns fires, the underlying method is not executing.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.debounce.Debouncer.start">
<code class="descname">start</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.debounce.Debouncer.start" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the debouncer.
This reverses the effects of <code class="docutils literal"><span class="pre">stop</span></code>.
This method can be called on a started debouncer without issues.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.util.json">
<span id="buildbot-util-json"></span><h2>buildbot.util.json<a class="headerlink" href="#module-buildbot.util.json" title="Permalink to this headline">¶</a></h2>
<p>This package is just an import of the best available JSON module.  Use it
instead of a more complex conditional import of <code class="xref py py-mod docutils literal"><span class="pre">simplejson</span></code> or
<code class="xref py py-mod docutils literal"><span class="pre">json</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.util</span> <span class="k">import</span> <span class="n">json</span>
</pre></div>
</div>
</div>
<div class="section" id="module-buildbot.util.maildir">
<span id="buildbot-util-maildir"></span><h2>buildbot.util.maildir<a class="headerlink" href="#module-buildbot.util.maildir" title="Permalink to this headline">¶</a></h2>
<p>Several Buildbot components make use of <a class="reference external" href="http://www.courier-mta.org/maildir.html">maildirs</a> to hand off messages between
components.  On the receiving end, there's a need to watch a maildir for
incoming messages and trigger some action when one arrives.</p>
<dl class="class">
<dt id="buildbot.util.maildir.MaildirService">
<em class="property">class </em><code class="descclassname">buildbot.util.maildir.</code><code class="descname">MaildirService</code><span class="sig-paren">(</span><em>basedir</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.maildir.MaildirService" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">param basedir:</th><td class="field-body">(optional) base directory of the maildir</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>A <a class="reference internal" href="#buildbot.util.maildir.MaildirService" title="buildbot.util.maildir.MaildirService"><code class="xref py py-class docutils literal"><span class="pre">MaildirService</span></code></a> instance watches a maildir for new messages. It
should be a child service of some <code class="xref py py-class docutils literal"><span class="pre">MultiService</span></code> instance. When
running, this class uses the linux dirwatcher API (if available) or polls for new
files in the 'new' maildir subdirectory. When it discovers a new
message, it invokes its <a class="reference internal" href="#buildbot.util.maildir.MaildirService.messageReceived" title="buildbot.util.maildir.MaildirService.messageReceived"><code class="xref py py-meth docutils literal"><span class="pre">messageReceived</span></code></a> method.</p>
<p>To use this class, subclass it and implement a more interesting
<a class="reference internal" href="#buildbot.util.maildir.MaildirService.messageReceived" title="buildbot.util.maildir.MaildirService.messageReceived"><code class="xref py py-meth docutils literal"><span class="pre">messageReceived</span></code></a> function.</p>
<dl class="method">
<dt id="buildbot.util.maildir.MaildirService.setBasedir">
<code class="descname">setBasedir</code><span class="sig-paren">(</span><em>basedir</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.maildir.MaildirService.setBasedir" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>basedir</strong> -- base directory of the maildir</td>
</tr>
</tbody>
</table>
<p>If no <code class="docutils literal"><span class="pre">basedir</span></code> is provided to the constructor, this method must be
used to set the basedir before the service starts.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.maildir.MaildirService.messageReceived">
<code class="descname">messageReceived</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.maildir.MaildirService.messageReceived" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>filename</strong> -- unqualified filename of the new message</td>
</tr>
</tbody>
</table>
<p>This method is called with the short filename of the new message. The
full name of the new file can be obtained with <code class="docutils literal"><span class="pre">os.path.join(maildir,</span>
<span class="pre">'new',</span> <span class="pre">filename)</span></code>.  The method is un-implemented in the
<a class="reference internal" href="#buildbot.util.maildir.MaildirService" title="buildbot.util.maildir.MaildirService"><code class="xref py py-class docutils literal"><span class="pre">MaildirService</span></code></a> class, and must be implemented in
subclasses.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.maildir.MaildirService.moveToCurDir">
<code class="descname">moveToCurDir</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.maildir.MaildirService.moveToCurDir" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>filename</strong> -- unqualified filename of the new message</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">open file object</td>
</tr>
</tbody>
</table>
<p>Call this from <a class="reference internal" href="#buildbot.util.maildir.MaildirService.messageReceived" title="buildbot.util.maildir.MaildirService.messageReceived"><code class="xref py py-meth docutils literal"><span class="pre">messageReceived</span></code></a> to start processing the
message; this moves the message file to the 'cur' directory and returns
an open file handle for it.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.util.misc">
<span id="buildbot-util-misc"></span><h2>buildbot.util.misc<a class="headerlink" href="#module-buildbot.util.misc" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="buildbot.util.misc.deferredLocked">
<code class="descclassname">buildbot.util.misc.</code><code class="descname">deferredLocked</code><span class="sig-paren">(</span><em>lock</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.misc.deferredLocked" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>lock</strong> -- a <code class="xref py py-class docutils literal"><span class="pre">twisted.internet.defer.DeferredLock</span></code> instance or
a string naming an instance attribute containing one</td>
</tr>
</tbody>
</table>
<p>This is a decorator to wrap an event-driven method (one returning a
<code class="docutils literal"><span class="pre">Deferred</span></code>) in an acquire/release pair of a designated
<code class="xref py py-class docutils literal"><span class="pre">DeferredLock</span></code>.  For simple functions
with a static lock, this is as easy as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">someLock</span> <span class="o">=</span> <span class="n">defer</span><span class="o">.</span><span class="n">DeferredLock</span><span class="p">()</span>
<span class="nd">@util</span><span class="o">.</span><span class="n">deferredLocked</span><span class="p">(</span><span class="n">someLock</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">someLockedFunction</span><span class="p">():</span>
    <span class="c1"># ..</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
<p>For class methods which must access a lock that is an instance attribute, the
lock can be specified by a string, which will be dynamically resolved to the
specific instance at runtime:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">someLock</span> <span class="o">=</span> <span class="n">defer</span><span class="o">.</span><span class="n">DeferredLock</span><span class="p">()</span>

<span class="nd">@util</span><span class="o">.</span><span class="n">deferredLocked</span><span class="p">(</span><span class="s1">&#39;someLock&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">someLockedFunction</span><span class="p">():</span>
    <span class="c1"># ..</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="buildbot.util.misc.SerializedInvocation">
<em class="property">class </em><code class="descclassname">buildbot.util.misc.</code><code class="descname">SerializedInvocation</code><span class="sig-paren">(</span><em>method</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.misc.SerializedInvocation" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a method wrapper that will serialize calls to an asynchronous
method.  If a second call occurs while the first call is still executing,
it will not begin until the first call has finished.  If multiple calls
queue up, they will be collapsed into a single call.  The effect is that
the underlying method is guaranteed to be called at least once after every
call to the wrapper.</p>
<p>Note that if this class is used as a decorator on a method, it will
serialize invocations across all class instances.  For synchronization
specific to each instance, wrap the method in the constructor:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">someMethod</span> <span class="o">=</span> <span class="n">SerializedInovcation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">someMethod</span><span class="p">)</span>
</pre></div>
</div>
<p>Tests can monkey-patch the <code class="docutils literal"><span class="pre">_quiet</span></code> method of the class to be notified
when all planned invocations are complete.</p>
</dd></dl>

</div>
<div class="section" id="module-buildbot.util.netstrings">
<span id="buildbot-util-netstrings"></span><h2>buildbot.util.netstrings<a class="headerlink" href="#module-buildbot.util.netstrings" title="Permalink to this headline">¶</a></h2>
<p>Similar to maildirs, <a class="reference external" href="http://cr.yp.to/proto/netstrings.txt">netstrings</a> are
used occasionally in Buildbot to encode data for interchange.  While Twisted
supports a basic netstring receiver protocol, it does not have a simple way to
apply that to a non-network situation.</p>
<dl class="class">
<dt id="buildbot.util.netstrings.NetstringParser">
<em class="property">class </em><code class="descclassname">buildbot.util.netstrings.</code><code class="descname">NetstringParser</code><a class="headerlink" href="#buildbot.util.netstrings.NetstringParser" title="Permalink to this definition">¶</a></dt>
<dd><p>This class parses strings piece by piece, either collecting the accumulated
strings or invoking a callback for each one.</p>
<dl class="method">
<dt id="buildbot.util.netstrings.NetstringParser.feed">
<code class="descname">feed</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.netstrings.NetstringParser.feed" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> -- a portion of netstring-formatted data</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><code class="xref py py-exc docutils literal"><span class="pre">twisted.protocols.basic.NetstringParseError</span></code></td>
</tr>
</tbody>
</table>
<p>Add arbitrarily-sized <code class="docutils literal"><span class="pre">data</span></code> to the incoming-data buffer.  Any
complete netstrings will trigger a call to the
<code class="xref py py-meth docutils literal"><span class="pre">stringReceived</span></code> method.</p>
<p>Note that this method (like the Twisted class it is based on) cannot
detect a trailing partial netstring at EOF - the data will be silently
ignored.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">stringReceived(string):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>string</strong> -- the decoded string</td>
</tr>
</tbody>
</table>
<p>This method is called for each decoded string as soon as it is read
completely.  The default implementation appends the string to the
<a class="reference internal" href="#buildbot.util.netstrings.NetstringParser.strings" title="buildbot.util.netstrings.NetstringParser.strings"><code class="xref py py-attr docutils literal"><span class="pre">strings</span></code></a> attribute, but subclasses can do anything.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.netstrings.NetstringParser.strings">
<code class="descname">strings</code><a class="headerlink" href="#buildbot.util.netstrings.NetstringParser.strings" title="Permalink to this definition">¶</a></dt>
<dd><p>The strings decoded so far, if <code class="xref py py-meth docutils literal"><span class="pre">stringReceived</span></code> is not
overridden.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.util.sautils">
<span id="buildbot-util-sautils"></span><h2>buildbot.util.sautils<a class="headerlink" href="#module-buildbot.util.sautils" title="Permalink to this headline">¶</a></h2>
<p>This module contains a few utilities that are not included with SQLAlchemy.</p>
<dl class="class">
<dt id="buildbot.util.sautils.InsertFromSelect">
<em class="property">class </em><code class="descclassname">buildbot.util.sautils.</code><code class="descname">InsertFromSelect</code><span class="sig-paren">(</span><em>table</em>, <em>select</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.sautils.InsertFromSelect" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>table</strong> -- table into which insert should be performed</li>
<li><strong>select</strong> -- select query from which data should be drawn</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This class is taken directly from SQLAlchemy's <a class="reference external" href="http://www.sqlalchemy.org/docs/core/compiler.html#compiling-sub-elements-of-a-custom-expression-construct">compiler.html</a>,
and allows a Pythonic representation of <code class="docutils literal"><span class="pre">INSERT</span> <span class="pre">INTO</span> <span class="pre">..</span> <span class="pre">SELECT</span> <span class="pre">..</span></code>
queries.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.sautils.sa_version">
<code class="descclassname">buildbot.util.sautils.</code><code class="descname">sa_version</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.sautils.sa_version" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a 3-tuple representing the SQLAlchemy version.  Note that older
versions that did not have a <code class="docutils literal"><span class="pre">__version__</span></code> attribute are represented by
<code class="docutils literal"><span class="pre">(0,0,0)</span></code>.</p>
</dd></dl>

</div>
<div class="section" id="buildbot-util-subscription">
<h2>buildbot.util.subscription<a class="headerlink" href="#buildbot-util-subscription" title="Permalink to this headline">¶</a></h2>
<p>The classes in the <code class="xref py py-mod docutils literal"><span class="pre">buildbot.util.subscription</span></code> module are used for
master-local subscriptions.  In the near future, all uses of this module will
be replaced with message-queueing implementations that allow subscriptions and
subscribers to span multiple masters.</p>
</div>
<div class="section" id="buildbot-util-croniter">
<h2>buildbot.util.croniter<a class="headerlink" href="#buildbot-util-croniter" title="Permalink to this headline">¶</a></h2>
<p>This module is a copy of <a class="reference external" href="https://github.com/taichino/croniter">https://github.com/taichino/croniter</a>, and provides
support for converting cron-like time specifications into actual times.</p>
</div>
<div class="section" id="module-buildbot.util.state">
<span id="buildbot-util-state"></span><h2>buildbot.util.state<a class="headerlink" href="#module-buildbot.util.state" title="Permalink to this headline">¶</a></h2>
<p>The classes in the <code class="xref py py-mod docutils literal"><span class="pre">buildbot.util.subscription</span></code> module are used for dealing with object state stored in the database.</p>
<dl class="class">
<dt id="buildbot.util.state.StateMixin">
<em class="property">class </em><code class="descclassname">buildbot.util.state.</code><code class="descname">StateMixin</code><a class="headerlink" href="#buildbot.util.state.StateMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>This class provides helper methods for accessing the object state stored in the database.</p>
<dl class="attribute">
<dt id="buildbot.util.state.StateMixin.name">
<code class="descname">name</code><a class="headerlink" href="#buildbot.util.state.StateMixin.name" title="Permalink to this definition">¶</a></dt>
<dd><p>This must be set to the name to be used to identify this object in the database.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.state.StateMixin.master">
<code class="descname">master</code><a class="headerlink" href="#buildbot.util.state.StateMixin.master" title="Permalink to this definition">¶</a></dt>
<dd><p>This must point to the <code class="xref py py-class docutils literal"><span class="pre">BuildMaster</span></code> object.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.state.StateMixin.getState">
<code class="descname">getState</code><span class="sig-paren">(</span><em>name</em>, <em>default</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.state.StateMixin.getState" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> -- name of the value to retrieve</li>
<li><strong>default</strong> -- (optional) value to return if <cite>name</cite> is not present</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">state value via a Deferred</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><ul class="first last simple">
<li><strong>KeyError</strong> -- if <cite>name</cite> is not present and no default is given</li>
<li><strong>TypeError</strong> -- if JSON parsing fails</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Get a named state value from the object's state.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">getState</code><span class="sig-paren">(</span><em>name</em>, <em>value</em><span class="sig-paren">)</span></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> -- the name of the value to change</li>
<li><strong>value</strong> -- the value to set - must be a JSONable object</li>
<li><strong>returns</strong> -- Deferred</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><strong>TypeError</strong> -- if JSONification fails</p>
</td>
</tr>
</tbody>
</table>
<p>Set a named state value in the object's persistent state.
Note that value must be json-able.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.util.identifiers">
<span id="buildbot-util-identifiers"></span><h2>buildbot.util.identifiers<a class="headerlink" href="#module-buildbot.util.identifiers" title="Permalink to this headline">¶</a></h2>
<p>This module makes it easy to manipulate identifiers.</p>
<dl class="function">
<dt id="buildbot.util.identifiers.isIdentifier">
<code class="descclassname">buildbot.util.identifiers.</code><code class="descname">isIdentifier</code><span class="sig-paren">(</span><em>maxLength</em>, <em>object</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.identifiers.isIdentifier" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>maxLength</strong> -- maximum length of the identifier</li>
<li><strong>object</strong> -- object to test for identifier-ness</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">boolean</p>
</td>
</tr>
</tbody>
</table>
<p>Is object an identifier?</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.identifiers.forceIdentifier">
<code class="descclassname">buildbot.util.identifiers.</code><code class="descname">forceIdentifier</code><span class="sig-paren">(</span><em>maxLength</em>, <em>str</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.identifiers.forceIdentifier" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>maxLength</strong> -- maximum length of the identifier</li>
<li><strong>str</strong> -- string to coerce to an identifier</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">identifer of maximum length <code class="docutils literal"><span class="pre">maxLength</span></code></p>
</td>
</tr>
</tbody>
</table>
<p>Coerce a string (assuming ASCII for bytestrings) into an identifier.
This method will replace any invalid characters with <code class="docutils literal"><span class="pre">_</span></code> and truncate to the given length.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.identifiers.incrementIdentifier">
<code class="descclassname">buildbot.util.identifiers.</code><code class="descname">incrementIdentifier</code><span class="sig-paren">(</span><em>maxLength</em>, <em>str</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.identifiers.incrementIdentifier" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>maxLength</strong> -- maximum length of the identifier</li>
<li><strong>str</strong> -- identifier to increment</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">identifer of maximum length <code class="docutils literal"><span class="pre">maxLength</span></code></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last">ValueError if no suitable identifier can be constructed</p>
</td>
</tr>
</tbody>
</table>
<p>&quot;Increment&quot; an identifier by adding a numeric suffix, while keeping the total length limited.
This is useful when selecting a unique identifier for an object.
Maximum-length identifiers like <code class="docutils literal"><span class="pre">_999999</span></code> cannot be incremented and will raise <code class="xref py py-exc docutils literal"><span class="pre">ValueError</span></code>.</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
<h3>Table Of Contents</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Buildbot Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../manual/index.html">Buildbot Manual</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Buildbot Development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="master-overview.html">Master Organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="definitions.html">Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="style.html">Buildbot Coding Style</a></li>
<li class="toctree-l2"><a class="reference internal" href="tests.html">Buildbot's Test Suite</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html">Configuration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="database.html">Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="results.html">Build Result Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="formats.html">File Formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="webstatus.html">Web Status</a></li>
<li class="toctree-l2"><a class="reference internal" href="master-slave.html">Master-Slave API</a></li>
<li class="toctree-l2"><a class="reference internal" href="encodings.html">String Encodings</a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics.html">Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugins-publish.html">How to package Buildbot plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="classes.html">Classes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../relnotes/index.html">Release Notes for Buildbot 0.8.14</a></li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="../search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
            </form>
          </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="config.html" title="Configuration"
              >previous</a> |
            <a href="database.html" title="Database"
              >next</a> |
            <a href="../py-modindex.html" title="Python Module Index"
              >modules</a> |
            <a href="../genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
              <br/>
              <a href="../_sources/developer/utils.txt"
                rel="nofollow">Show Source</a>
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &copy; Copyright Buildbot Team Members.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.5.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>